# ============================================================
# SAMPLE TEST WORKFLOW TEMPLATE 
#
# PURPOSE
# -------
# This workflow is a TEMPLATE and CONTRACT for creating new
# test workflows in this repository.
#
# How to use:
# 1. Copy this file
# 2. Rename it to: test-<your-test-name>.yaml
# 3. Replace the example steps with your real test logic
#
# IMPORTANT RULES
# ---------------
# - DO NOT add triggers like push or pull_request
# - This workflow MUST be invoked only by pipeline.yaml
# - Use workflow_call and follow the input contract
# - Keep ONE job per test workflow
# ============================================================

name: Sample Test Template

on:
  workflow_call:
    inputs:
      # ------------------------------------------------------
      # STANDARD INPUTS (REQUIRED FOR ALL TEST WORKFLOWS)
      # ------------------------------------------------------
      python-version:
        description: "Python version to use for this test"
        required: true
        type: string

      working-directory:
        description: "Directory where the project or test should run"
        required: true
        type: string

      fail-on-issues:
        description: "If true, the test must fail the pipeline on issues"
        required: true
        type: boolean

      # ------------------------------------------------------
      # OPTIONAL / EXAMPLE INPUTS
      # ------------------------------------------------------
      config-file:
        description: "Optional configuration file for the test tool"
        required: false
        type: string
        default: ""

      scan-path:
        description: "Optional path to scan or test"
        required: false
        type: string
        default: "."

      build-artifacts-path:
        description: "Path to artifacts from the build job (optional)"
        required: false
        type: string
        default: ""

jobs:
  sample-test:
    runs-on: ubuntu-latest

    steps:
      # ------------------------------------------------------
      # Step 1: Checkout repository
      # ------------------------------------------------------
      - name: Checkout repository
        uses: actions/checkout@v4

      # ------------------------------------------------------
      # Step 2: Set up Python
      # ------------------------------------------------------
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: ${{ inputs.python-version }}

      # ------------------------------------------------------
      # Step 3: Download build artifacts (optional)
      # ------------------------------------------------------
      - name: Download build artifacts
        if: ${{ inputs.build-artifacts-path != '' }}
        uses: actions/download-artifact@v4
        with:
          name: build-artifacts
          path: ${{ inputs.build-artifacts-path }}

      # ------------------------------------------------------
      # Step 4: Install test dependencies (example)
      # ------------------------------------------------------
      - name: Install test dependencies
        working-directory: ${{ inputs.working-directory }}
        run: |
          echo "Install test-specific dependencies here"
          # Example: pip install -r requirements.txt

      # ------------------------------------------------------
      # Step 5: Run the test (example)
      # ------------------------------------------------------
      - name: Run test
        working-directory: ${{ inputs.working-directory }}
        run: |
          echo "Run your test logic here"
          echo "Config file: ${{ inputs.config-file }}"
          echo "Scan path: ${{ inputs.scan-path }}"

      # ------------------------------------------------------
      # Step 6: Enforce failure policy
      # ------------------------------------------------------
      - name: Enforce test policy
        if: ${{ inputs.fail-on-issues }}
        run: |
          echo "Evaluating test results..."
          echo "Failing pipeline because fail-on-issues=true"
          # exit 1  # Uncomment in real tests when issues are detected

      # ------------------------------------------------------
      # Step 7: Upload test artifacts (optional but recommended)
      # ------------------------------------------------------
      - name: Upload test artifacts
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: sample-test-artifacts
          path: |
            ./example-results.json
